Instance
--------

Every object, enemy or player is an instance, the game can hold up to 208 instances in memory. Examples of instances are:

* Lara
* Levers, pressure plates and doors
* Ropes and swing poles
* Inventory items and grappling hook
* Enemies
* Water

Below images are taken without any instances loaded (minus lara)

[cols="2*",frame="none"]
|===
|image:images/1.jpg[width=500] Doors, levers and movable platforms missing
|image:images/2.jpg[width=500]

|image:images/3.jpg[width=500]
|image:images/4.jpg[width=500] Water missing
|===

Offsets
~~~~~~~

* Instance + `0x10` = Position
* Instance + `0x30` = Rotation
* Instance + `0x50` = Scale
* Instance + `0x94` = Pointer to the object
* Instance + `0xB1` = Model id;
* Instance + `0xEC` = Instance id

Creation
~~~~~~~~

An instance can be spawned by calling one of the game's \'birth' functions, the game will check if there is space in the instance pool (else return 0) and get the next instance id.

[source,cpp]
----
// generated by IDA decompiler
result = (_DWORD *)gInstances;
if ( !gInstances )
	return 0;
gInstances = *(_DWORD *)(gInstances + 8); // next instance
v1 = dword_817D64;
v2 = dword_817D64 == 0;
dword_817D64 = result;
result[2] = v1;
if ( !v2 )
v1[3] = result;
result[3] = 0;
result[59] = gNextInstanceId++; // assign next instance id to instance
++gNumInstances;
return result; // return instance
----